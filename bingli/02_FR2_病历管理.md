# FR2 - 病历管理功能需求

## 1. 功能概述

病历管理模块是AI病例管理系统的核心功能，提供完整的病历记录创建、编辑、分类、搜索和管理功能，支持多媒体病历信息存储和智能化管理。

## 2. 功能需求

### 2.1 病历记录管理

#### 2.1.1 创建病历记录
- **功能描述**：用户可以为家庭成员创建新的病历记录
- **输入**：
  - 就诊日期
  - 医院名称
  - 科室信息
  - 医生姓名
  - 主诉症状
  - 诊断结果
  - 治疗方案
  - 用药信息
  - 病历照片
  - 检查报告
- **输出**：新创建的病历记录
- **业务规则**：
  - 必填字段验证
  - 日期不能超过当前时间
  - 支持多张图片上传
  - 自动生成病历编号

#### 2.1.2 编辑病历记录
- **功能描述**：修改已有的病历记录信息
- **输入**：病历ID、修改的字段信息
- **输出**：更新后的病历记录
- **业务规则**：
  - 只有有权限的用户可以编辑
  - 记录修改历史
  - 重要信息修改需要确认
  - 支持部分字段更新

#### 2.1.3 删除病历记录
- **功能描述**：删除不需要的病历记录
- **输入**：病历ID
- **输出**：删除确认结果
- **业务规则**：
  - 软删除机制，支持恢复
  - 删除前需要用户确认
  - 记录删除操作日志
  - 关联文件同步删除

#### 2.1.4 病历详情查看
- **功能描述**：查看病历的详细信息
- **输入**：病历ID
- **输出**：完整的病历信息
- **业务规则**：
  - 权限验证
  - 支持图片放大查看
  - 显示创建和修改时间
  - 支持分享功能

### 2.2 病历分类管理

#### 2.2.1 自动分类
- **功能描述**：基于AI算法自动对病历进行分类
- **输入**：病历内容、症状描述、诊断信息
- **输出**：推荐的分类标签
- **业务规则**：
  - 支持多级分类
  - 分类准确率>85%
  - 用户可以修改分类结果
  - 学习用户分类习惯

#### 2.2.2 手动分类
- **功能描述**：用户手动设置病历分类
- **输入**：病历ID、分类标签
- **输出**：分类设置结果
- **业务规则**：
  - 支持多标签分类
  - 预设常用分类模板
  - 支持自定义分类
  - 分类统计分析

#### 2.2.3 分类管理
- **功能描述**：管理病历分类体系
- **输入**：分类操作类型、分类信息
- **输出**：分类管理结果
- **业务规则**：
  - 支持分类的增删改查
  - 分类层级不超过3级
  - 删除分类时处理关联病历
  - 分类使用频率统计

### 2.3 病历搜索功能

#### 2.3.1 关键词搜索
- **功能描述**：通过关键词搜索相关病历
- **输入**：搜索关键词
- **输出**：匹配的病历列表
- **业务规则**：
  - 支持模糊搜索
  - 搜索结果按相关度排序
  - 高亮显示匹配关键词
  - 搜索历史记录

#### 2.3.2 高级搜索
- **功能描述**：通过多个条件组合搜索病历
- **输入**：
  - 时间范围
  - 家庭成员
  - 病历分类
  - 医院科室
  - 医生姓名
- **输出**：符合条件的病历列表
- **业务规则**：
  - 支持多条件组合
  - 条件之间支持AND/OR逻辑
  - 搜索结果支持排序
  - 保存常用搜索条件

#### 2.3.3 智能搜索
- **功能描述**：基于AI的智能病历搜索
- **输入**：自然语言描述
- **输出**：相关病历推荐
- **业务规则**：
  - 理解用户意图
  - 语义匹配搜索
  - 相关性评分
  - 搜索建议提示

### 2.4 病历统计分析

#### 2.4.1 就医统计
- **功能描述**：统计家庭成员的就医情况
- **输入**：统计时间范围、成员选择
- **输出**：就医统计报告
- **业务规则**：
  - 按时间、成员、科室统计
  - 生成可视化图表
  - 支持数据导出
  - 趋势分析功能

#### 2.4.2 疾病分析
- **功能描述**：分析家庭成员的疾病情况
- **输入**：分析维度、时间范围
- **输出**：疾病分析报告
- **业务规则**：
  - 疾病分布统计
  - 慢性病跟踪
  - 家族病史分析
  - 健康风险评估

#### 2.4.3 用药统计
- **功能描述**：统计用药情况和费用
- **输入**：统计条件
- **输出**：用药统计报告
- **业务规则**：
  - 用药频次统计
  - 药物过敏记录
  - 用药费用统计
  - 用药安全提醒

## 3. 界面设计要求

### 3.1 病历列表页面
- 时间轴式布局显示病历
- 支持按成员、分类筛选
- 搜索框和筛选器
- 悬浮添加按钮
- 下拉刷新和上拉加载

### 3.2 病历详情页面
- 卡片式信息展示
- 图片轮播查看
- 编辑和分享按钮
- 相关病历推荐
- 评论和标注功能

### 3.3 创建/编辑病历页面
- 分步骤表单设计
- 智能输入提示
- 图片上传和预览
- 自动保存草稿
- 表单验证提示

### 3.4 搜索页面
- 搜索框和历史记录
- 高级搜索选项
- 搜索结果列表
- 筛选和排序功能
- 搜索建议

### 3.5 统计分析页面
- 数据可视化图表
- 时间范围选择器
- 多维度分析选项
- 报告导出功能
- 趋势预测展示

## 4. 数据模型

### 4.1 病历记录表 (medical_records)
```javascript
{
  _id: ObjectId,
  userId: ObjectId,         // 用户ID
  memberId: ObjectId,       // 家庭成员ID
  recordNo: String,         // 病历编号
  title: String,            // 病历标题
  visitDate: Date,          // 就诊日期
  hospital: String,         // 医院名称
  department: String,       // 科室
  doctor: String,           // 医生姓名
  symptoms: String,         // 主诉症状
  diagnosis: String,        // 诊断结果
  treatment: String,        // 治疗方案
  medications: Array,       // 用药信息
  images: Array,            // 病历图片
  reports: Array,           // 检查报告
  category: String,         // 分类
  tags: Array,              // 标签
  cost: Number,             // 费用
  notes: String,            // 备注
  createTime: Date,         // 创建时间
  updateTime: Date,         // 更新时间
  status: Number            // 状态
}
```

### 4.2 病历分类表 (categories)
```javascript
{
  _id: ObjectId,
  userId: ObjectId,         // 用户ID
  name: String,             // 分类名称
  parentId: ObjectId,       // 父分类ID
  level: Number,            // 分类层级
  icon: String,             // 分类图标
  color: String,            // 分类颜色
  description: String,      // 分类描述
  sort: Number,             // 排序
  useCount: Number,         // 使用次数
  createTime: Date,         // 创建时间
  status: Number            // 状态
}
```

### 4.3 用药记录表 (medications)
```javascript
{
  _id: ObjectId,
  recordId: ObjectId,       // 病历ID
  name: String,             // 药品名称
  specification: String,    // 规格
  dosage: String,           // 用量
  frequency: String,        // 频次
  duration: String,         // 疗程
  usage: String,            // 用法
  price: Number,            // 价格
  manufacturer: String,     // 生产厂家
  batchNo: String,          // 批号
  expireDate: Date,         // 有效期
  notes: String,            // 备注
  createTime: Date          // 创建时间
}
```

## 5. API接口设计

### 5.1 病历记录接口
- `GET /api/records` - 获取病历列表
- `POST /api/records` - 创建病历记录
- `GET /api/records/:id` - 获取病历详情
- `PUT /api/records/:id` - 更新病历记录
- `DELETE /api/records/:id` - 删除病历记录

### 5.2 分类管理接口
- `GET /api/categories` - 获取分类列表
- `POST /api/categories` - 创建分类
- `PUT /api/categories/:id` - 更新分类
- `DELETE /api/categories/:id` - 删除分类

### 5.3 搜索接口
- `GET /api/search` - 关键词搜索
- `POST /api/search/advanced` - 高级搜索
- `GET /api/search/suggestions` - 搜索建议

### 5.4 统计分析接口
- `GET /api/statistics/visits` - 就医统计
- `GET /api/statistics/diseases` - 疾病分析
- `GET /api/statistics/medications` - 用药统计

### 5.5 文件上传接口
- `POST /api/upload/images` - 上传病历图片
- `POST /api/upload/reports` - 上传检查报告
- `DELETE /api/upload/:fileId` - 删除文件

## 6. 特殊功能

### 6.1 OCR文字识别
- **功能描述**：识别病历图片中的文字信息
- **应用场景**：处方单、检查报告、病历本
- **技术要求**：识别准确率>90%
- **业务规则**：
  - 支持多种图片格式
  - 识别结果可编辑
  - 结构化数据提取
  - 医学术语优化

### 6.2 智能提醒
- **功能描述**：基于病历数据的智能提醒
- **提醒类型**：
  - 复诊提醒
  - 用药提醒
  - 检查提醒
  - 疫苗接种提醒
- **业务规则**：
  - 自动分析病历生成提醒
  - 支持自定义提醒时间
  - 多种提醒方式
  - 提醒历史记录

### 6.3 数据导入导出
- **导入功能**：
  - 支持Excel格式导入
  - 图片批量导入
  - 其他系统数据迁移
- **导出功能**：
  - PDF格式病历报告
  - Excel格式数据导出
  - 图片打包下载
  - 数据备份功能

## 7. 性能要求

### 7.1 响应时间
- 病历列表加载 < 2秒
- 病历详情查看 < 1秒
- 搜索结果返回 < 3秒
- 图片上传处理 < 10秒

### 7.2 存储要求
- 单个病历图片 < 5MB
- 单用户存储空间 < 1GB
- 数据压缩和优化
- 云存储备份机制

## 8. 安全要求

### 8.1 数据加密
- 敏感信息加密存储
- 传输过程加密
- 图片水印保护
- 访问日志记录

### 8.2 隐私保护
- 数据脱敏处理
- 权限严格控制
- 数据使用授权
- 隐私政策遵循
