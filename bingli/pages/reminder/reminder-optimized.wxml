<!-- pages/reminder/reminder-optimized.wxml - ç°ä»£åŒ–å¥åº·æé†’é¡µé¢ -->
<view class="reminder-container-modern">
  <!-- é¡¶éƒ¨æ™ºèƒ½æ¦‚è§ˆ -->
  <view class="reminder-hero-section">
    <view class="hero-background">
      <view class="hero-pattern"></view>
    </view>
    
    <view class="hero-content">
      <view class="hero-header">
        <text class="hero-title">ğŸ”” æ™ºèƒ½å¥åº·æé†’</text>
        <text class="hero-subtitle">AIä¸ºæ‚¨ç®¡ç†å®¶åº­å¥åº·æ—¶é—´è¡¨</text>
      </view>
      
      <!-- ä»Šæ—¥æé†’æ¦‚è§ˆ -->
      <view class="today-overview">
        <view class="overview-main">
          <text class="overview-number">{{todayReminders.length}}</text>
          <text class="overview-label">ä»Šæ—¥å¾…åŠ</text>
        </view>
        <view class="overview-stats">
          <view class="stat-item">
            <text class="stat-icon">ğŸ’Š</text>
            <text class="stat-count">{{todayMedicineCount}}</text>
            <text class="stat-label">ç”¨è¯</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ¥</text>
            <text class="stat-count">{{todayCheckupCount}}</text>
            <text class="stat-label">å°±è¯Š</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ’ª</text>
            <text class="stat-count">{{todayExerciseCount}}</text>
            <text class="stat-label">è¿åŠ¨</text>
          </view>
        </view>
      </view>
      
      <!-- AIå¥åº·æ´å¯Ÿ -->
      <view class="ai-insights" wx:if="{{aiInsights && aiInsights.length > 0}}">
        <scroll-view class="insights-scroll" scroll-x>
          <view class="insights-list">
            <view 
              class="insight-card"
              wx:for="{{aiInsights}}"
              wx:key="id"
              data-insight="{{item}}"
              bindtap="onViewInsight"
            >
              <view class="insight-icon">{{item.icon}}</view>
              <view class="insight-content">
                <text class="insight-title">{{item.title}}</text>
                <text class="insight-description">{{item.description}}</text>
              </view>
              <view class="insight-action">
                <text class="action-arrow">â†’</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- æ™ºèƒ½ç­›é€‰å¯¼èˆª -->
  <view class="smart-navigation">
    <scroll-view class="nav-scroll" scroll-x>
      <view class="nav-tabs">
        <view 
          class="nav-tab {{activeTab === index ? 'active' : ''}}"
          wx:for="{{smartTabs}}"
          wx:key="id"
          data-index="{{index}}"
          bindtap="onTabChange"
        >
          <view class="tab-icon">{{item.icon}}</view>
          <text class="tab-text">{{item.name}}</text>
          <view class="tab-badge" wx:if="{{item.count > 0}}">{{item.count}}</view>
        </view>
      </view>
    </scroll-view>
    
    <!-- å¿«é€Ÿæ“ä½œæ  -->
    <view class="quick-actions-bar">
      <view class="action-group">
        <view class="quick-action-item" bindtap="onSmartReminder">
          <text class="action-icon">ğŸ¤–</text>
          <text class="action-text">AIæé†’</text>
        </view>
        <view class="quick-action-item" bindtap="onAddReminder">
          <text class="action-icon">â•</text>
          <text class="action-text">æ·»åŠ </text>
        </view>
        <view class="quick-action-item" bindtap="onReminderSettings">
          <text class="action-icon">âš™ï¸</text>
          <text class="action-text">è®¾ç½®</text>
        </view>
      </view>
      
      <view class="view-controls">
        <view 
          class="view-control-item {{viewMode === 'timeline' ? 'active' : ''}}"
          data-mode="timeline"
          bindtap="onChangeViewMode"
        >
          <text class="control-icon">ğŸ“…</text>
        </view>
        <view 
          class="view-control-item {{viewMode === 'grid' ? 'active' : ''}}"
          data-mode="grid"
          bindtap="onChangeViewMode"
        >
          <text class="control-icon">â–¦</text>
        </view>
        <view 
          class="view-control-item {{viewMode === 'list' ? 'active' : ''}}"
          data-mode="list"
          bindtap="onChangeViewMode"
        >
          <text class="control-icon">â˜°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-filter-section" wx:if="{{showSearchFilter}}">
    <view class="search-container">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input"
          placeholder="æœç´¢æé†’å†…å®¹ã€æˆå‘˜æˆ–ç±»å‹..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <view class="search-actions" wx:if="{{searchKeyword}}">
          <text class="clear-btn" bindtap="onClearSearch">Ã—</text>
        </view>
      </view>
    </view>
    
    <view class="filter-options">
      <scroll-view class="filter-scroll" scroll-x>
        <view class="filter-chips">
          <view 
            class="filter-chip {{selectedFilters.includes(filter.key) ? 'active' : ''}}"
            wx:for="{{filterOptions}}"
            wx:for-item="filter"
            wx:key="key"
            data-filter="{{filter.key}}"
            bindtap="onToggleFilter"
          >
            <text class="chip-icon">{{filter.icon}}</text>
            <text class="chip-text">{{filter.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="reminder-main-content">
    <!-- ä»Šæ—¥ç´§æ€¥æé†’ -->
    <view class="urgent-reminders" wx:if="{{urgentReminders.length > 0}}">
      <view class="urgent-header">
        <text class="urgent-title">ğŸš¨ ç´§æ€¥æé†’</text>
        <text class="urgent-count">{{urgentReminders.length}}é¡¹</text>
      </view>
      <view class="urgent-list">
        <view 
          class="urgent-item"
          wx:for="{{urgentReminders}}"
          wx:key="id"
          data-reminder="{{item}}"
          bindtap="onUrgentReminderTap"
        >
          <view class="urgent-indicator"></view>
          <view class="urgent-content">
            <text class="urgent-reminder-title">{{item.title}}</text>
            <text class="urgent-time">{{item.timeText}}</text>
          </view>
          <view class="urgent-actions">
            <view class="urgent-action-btn complete" catchtap="onCompleteReminder" data-id="{{item.id}}">
              <text class="action-text">å®Œæˆ</text>
            </view>
            <view class="urgent-action-btn snooze" catchtap="onSnoozeReminder" data-id="{{item.id}}">
              <text class="action-text">ç¨å</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æé†’å†…å®¹ - æ—¶é—´çº¿è§†å›¾ -->
    <view class="reminders-timeline" wx:if="{{viewMode === 'timeline'}}">
      <view class="timeline-container">
        <view 
          class="timeline-section"
          wx:for="{{groupedReminders}}"
          wx:for-item="group"
          wx:key="date"
        >
          <view class="timeline-date-header">
            <view class="date-indicator">
              <text class="date-day">{{group.dayText}}</text>
              <text class="date-full">{{group.dateText}}</text>
            </view>
            <view class="date-stats">
              <text class="date-total">{{group.reminders.length}}é¡¹æé†’</text>
              <text class="date-status">{{group.completedCount}}/{{group.reminders.length}}å·²å®Œæˆ</text>
            </view>
          </view>
          
          <view class="timeline-items">
            <view 
              class="timeline-item"
              wx:for="{{group.reminders}}"
              wx:key="id"
              data-reminder="{{item}}"
              bindtap="onReminderTap"
            >
              <view class="timeline-time">
                <text class="time-text">{{item.time}}</text>
                <view class="time-dot status-{{item.status}}"></view>
              </view>
              
              <view class="timeline-content">
                <view class="reminder-card-timeline">
                  <view class="reminder-header">
                    <view class="reminder-type-icon type-{{item.type}}">
                      <text class="type-icon">{{getTypeIcon(item.type)}}</text>
                    </view>
                    <view class="reminder-main-info">
                      <text class="reminder-title">{{item.title}}</text>
                      <text class="reminder-member">{{item.memberName}}</text>
                    </view>
                    <view class="reminder-status-badge status-{{item.status}}">
                      <text class="status-text">{{getStatusText(item.status)}}</text>
                    </view>
                  </view>
                  
                  <view class="reminder-details" wx:if="{{item.description || item.dosage || item.location}}">
                    <text class="detail-text" wx:if="{{item.description}}">{{item.description}}</text>
                    <view class="detail-meta">
                      <text class="meta-item" wx:if="{{item.dosage}}">ğŸ’Š {{item.dosage}}</text>
                      <text class="meta-item" wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
                      <text class="meta-item" wx:if="{{item.doctor}}">ğŸ‘¨â€âš•ï¸ {{item.doctor}}</text>
                    </view>
                  </view>
                  
                  <view class="reminder-actions" wx:if="{{item.status === 'pending'}}">
                    <view class="action-btn-group">
                      <view class="action-btn complete-btn" catchtap="onCompleteReminder" data-id="{{item.id}}">
                        <text class="btn-icon">âœ“</text>
                        <text class="btn-text">å®Œæˆ</text>
                      </view>
                      <view class="action-btn snooze-btn" catchtap="onSnoozeReminder" data-id="{{item.id}}">
                        <text class="btn-icon">â°</text>
                        <text class="btn-text">ç¨åæé†’</text>
                      </view>
                      <view class="action-btn more-btn" catchtap="onMoreReminderActions" data-reminder="{{item}}">
                        <text class="btn-icon">â‹¯</text>
                      </view>
                    </view>
                  </view>
                  
                  <!-- AIæ™ºèƒ½å»ºè®® -->
                  <view class="ai-suggestions" wx:if="{{item.aiSuggestions && item.aiSuggestions.length > 0}}">
                    <view class="suggestions-header">
                      <text class="suggestions-title">ğŸ¤– AIå»ºè®®</text>
                    </view>
                    <view class="suggestions-list">
                      <text 
                        class="suggestion-item"
                        wx:for="{{item.aiSuggestions}}"
                        wx:for-item="suggestion"
                        wx:key="*this"
                      >â€¢ {{suggestion}}</text>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æé†’å†…å®¹ - ç½‘æ ¼è§†å›¾ -->
    <view class="reminders-grid" wx:if="{{viewMode === 'grid'}}">
      <view class="grid-container">
        <view 
          class="reminder-card-grid"
          wx:for="{{filteredReminders}}"
          wx:key="id"
          data-reminder="{{item}}"
          bindtap="onReminderTap"
        >
          <view class="card-status-indicator status-{{item.status}}"></view>
          
          <view class="card-header">
            <view class="card-type-icon type-{{item.type}}">
              <text class="type-icon">{{getTypeIcon(item.type)}}</text>
            </view>
            <view class="card-time">
              <text class="time-text">{{item.time}}</text>
              <text class="date-text">{{item.dateText}}</text>
            </view>
          </view>
          
          <view class="card-content">
            <text class="card-title">{{item.title}}</text>
            <text class="card-member">{{item.memberName}}</text>
            <text class="card-description" wx:if="{{item.description}}">{{item.description}}</text>
          </view>
          
          <view class="card-footer" wx:if="{{item.status === 'pending'}}">
            <view class="quick-complete" catchtap="onCompleteReminder" data-id="{{item.id}}">
              <text class="complete-icon">âœ“</text>
            </view>
            <view class="card-priority priority-{{item.priority || 'normal'}}">
              <text class="priority-text">{{getPriorityText(item.priority)}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æé†’å†…å®¹ - åˆ—è¡¨è§†å›¾ -->
    <view class="reminders-list" wx:if="{{viewMode === 'list'}}">
      <view class="list-container">
        <view 
          class="reminder-item-list"
          wx:for="{{filteredReminders}}"
          wx:key="id"
          data-reminder="{{item}}"
          bindtap="onReminderTap"
        >
          <view class="list-checkbox" wx:if="{{item.status === 'pending'}}">
            <view class="checkbox" catchtap="onCompleteReminder" data-id="{{item.id}}">
              <text class="checkbox-icon">â—‹</text>
            </view>
          </view>
          <view class="list-checkbox completed" wx:else>
            <view class="checkbox">
              <text class="checkbox-icon">âœ“</text>
            </view>
          </view>
          
          <view class="list-content">
            <view class="list-main">
              <text class="list-title">{{item.title}}</text>
              <text class="list-member">{{item.memberName}}</text>
            </view>
            <view class="list-details">
              <text class="list-time">{{item.time}} â€¢ {{item.dateText}}</text>
              <text class="list-type">{{getTypeText(item.type)}}</text>
            </view>
          </view>
          
          <view class="list-actions">
            <view class="list-type-icon type-{{item.type}}">
              <text class="type-icon">{{getTypeIcon(item.type)}}</text>
            </view>
            <view class="list-priority priority-{{item.priority || 'normal'}}">
              <text class="priority-dot">â—</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ™ºèƒ½åˆ†æé¢æ¿ -->
  <view class="smart-analysis-panel" wx:if="{{showAnalysisPanel}}">
    <view class="analysis-overlay" bindtap="onCloseAnalysisPanel"></view>
    <view class="analysis-content">
      <view class="analysis-header">
        <text class="analysis-title">ğŸ“Š æ™ºèƒ½åˆ†æ</text>
        <text class="analysis-close" bindtap="onCloseAnalysisPanel">Ã—</text>
      </view>
      
      <view class="analysis-body">
        <!-- å®Œæˆç‡ç»Ÿè®¡ -->
        <view class="completion-stats">
          <view class="stats-header">
            <text class="stats-title">å®Œæˆç‡åˆ†æ</text>
            <text class="stats-period">è¿‘30å¤©</text>
          </view>
          <view class="stats-chart">
            <view class="chart-bar">
              <view class="bar-fill" style="width: {{completionRate}}%"></view>
            </view>
            <text class="chart-percentage">{{completionRate}}%</text>
          </view>
          <view class="stats-details">
            <view class="stat-item">
              <text class="stat-label">æ€»æé†’</text>
              <text class="stat-value">{{totalReminders}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">å·²å®Œæˆ</text>
              <text class="stat-value">{{completedReminders}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">å¹³å‡å“åº”</text>
              <text class="stat-value">{{avgResponseTime}}</text>
            </view>
          </view>
        </view>
        
        <!-- ç±»å‹åˆ†å¸ƒ -->
        <view class="type-distribution">
          <view class="distribution-header">
            <text class="distribution-title">æé†’ç±»å‹åˆ†å¸ƒ</text>
          </view>
          <view class="distribution-chart">
            <view 
              class="distribution-item"
              wx:for="{{reminderTypeStats}}"
              wx:key="type"
            >
              <view class="type-color" style="background-color: {{item.color}}"></view>
              <text class="type-name">{{item.name}}</text>
              <text class="type-count">{{item.count}}</text>
              <text class="type-percentage">{{item.percentage}}%</text>
            </view>
          </view>
        </view>
        
        <!-- AIå»ºè®® -->
        <view class="ai-recommendations">
          <view class="recommendations-header">
            <text class="recommendations-title">ğŸ¤– ä¼˜åŒ–å»ºè®®</text>
          </view>
          <view class="recommendations-list">
            <view 
              class="recommendation-item"
              wx:for="{{aiRecommendations}}"
              wx:key="id"
            >
              <view class="recommendation-icon">{{item.icon}}</view>
              <view class="recommendation-content">
                <text class="recommendation-title">{{item.title}}</text>
                <text class="recommendation-description">{{item.description}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state-reminders" wx:if="{{filteredReminders.length === 0 && !loading}}">
    <view class="empty-animation">
      <text class="empty-icon">ğŸ””</text>
      <view class="empty-rings">
        <view class="ring ring1"></view>
        <view class="ring ring2"></view>
        <view class="ring ring3"></view>
      </view>
    </view>
    <text class="empty-title">æš‚æ— æé†’</text>
    <text class="empty-description">
      {{activeTab === 0 ? 'ä»Šæ—¥æš‚æ— å¾…åŠæé†’' : activeTab === 1 ? 'æš‚æ— å³å°†åˆ°æ¥çš„æé†’' : 'è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•æé†’'}}
    </text>
    <view class="empty-actions">
      <view class="empty-action-btn" bindtap="onAddReminder">
        <text class="action-icon">â•</text>
        <text class="action-text">åˆ›å»ºæé†’</text>
      </view>
      <view class="empty-action-btn" bindtap="onSmartReminder">
        <text class="action-icon">ğŸ¤–</text>
        <text class="action-text">AIæ™ºèƒ½æé†’</text>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="floating-add-btn" wx:if="{{!showQuickMenu}}" bindtap="onShowQuickAddMenu">
    <view class="fab-main">
      <text class="fab-icon">+</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ·»åŠ èœå• -->
  <view class="quick-add-menu" wx:if="{{showQuickMenu}}">
    <view class="quick-menu-overlay" bindtap="onCloseQuickAddMenu"></view>
    <view class="quick-menu-items">
      <view class="quick-menu-item" bindtap="onQuickAddMedicine" data-type="medicine">
        <view class="menu-item-icon type-medicine">
          <text class="item-icon">ğŸ’Š</text>
        </view>
        <text class="menu-item-text">ç”¨è¯æé†’</text>
      </view>
      
      <view class="quick-menu-item" bindtap="onQuickAddCheckup" data-type="checkup">
        <view class="menu-item-icon type-checkup">
          <text class="item-icon">ğŸ¥</text>
        </view>
        <text class="menu-item-text">å°±è¯Šæé†’</text>
      </view>
      
      <view class="quick-menu-item" bindtap="onQuickAddExercise" data-type="exercise">
        <view class="menu-item-icon type-exercise">
          <text class="item-icon">ğŸ’ª</text>
        </view>
        <text class="menu-item-text">è¿åŠ¨æé†’</text>
      </view>
      
      <view class="quick-menu-item" bindtap="onQuickAddCustom" data-type="custom">
        <view class="menu-item-icon type-custom">
          <text class="item-icon">ğŸ“</text>
        </view>
        <text class="menu-item-text">è‡ªå®šä¹‰</text>
      </view>
    </view>
    
    <view class="floating-add-btn active" bindtap="onCloseQuickAddMenu">
      <view class="fab-main">
        <text class="fab-icon">Ã—</text>
      </view>
    </view>
  </view>

  <!-- å…¨å±€åŠ è½½çŠ¶æ€ -->
  <view class="global-loading" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">{{loadingText || 'åŠ è½½ä¸­...'}}</text>
    </view>
  </view>
</view> 