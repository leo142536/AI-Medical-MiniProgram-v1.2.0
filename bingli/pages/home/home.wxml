<!-- pages/home/home.wxml -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <view class="greeting">
      <text class="time-greeting">{{timeGreeting}}</text>
      <text class="user-name">{{userInfo.nickName || 'ç”¨æˆ·'}}</text>
    </view>
    <view class="weather-info">
      <text class="weather">{{weather || 'è·å–å¤©æ°”ä¸­...'}}</text>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œåŒºåŸŸ -->
  <view class="quick-actions">
    <view 
      class="action-item" 
      wx:for="{{quickActions}}" 
      wx:key="id"
      data-id="{{item.id}}"
      data-path="{{item.path}}"
      bindtap="onQuickActionTap"
    >
      <view class="action-icon-container">
        <view class="action-icon">{{item.icon}}</view>
      </view>
      <text class="action-title">{{item.title}}</text>
    </view>
  </view>

  <!-- å®¶åº­æˆå‘˜æ¦‚è§ˆ -->
  <view class="section family-section">
    <view class="section-header">
      <text class="section-title">å®¶åº­æˆå‘˜</text>
      <view class="header-actions">
        <view class="add-member-header-btn" bindtap="onAddFamilyMember">
          <text class="add-icon-header">+</text>
        </view>
        <view class="delete-member-header-btn" bindtap="onToggleDeleteMode">
          <text class="delete-icon-header">{{isDeleteMode ? 'å®Œæˆ' : 'âˆ’'}}</text>
        </view>
        <text class="section-more" bindtap="onViewMoreFamily">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
    </view>
    <scroll-view class="member-scroll" scroll-x="true">
      <view class="member-list">
        <view 
          class="member-item {{isDeleteMode ? 'delete-mode' : ''}}" 
          wx:for="{{familyMembers}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onFamilyMemberTap"
        >
          <view class="member-avatar">
            <image 
              class="avatar-img" 
              src="{{item.avatar || '/images/default-avatar.png'}}" 
              mode="aspectFill"
            />
            <!-- åˆ é™¤æŒ‰é’® -->
            <view 
              wx:if="{{isDeleteMode && item.relation !== 'æœ¬äºº'}}" 
              class="delete-member-btn"
              data-id="{{item.id}}"
              data-name="{{item.name}}"
              bindtap="onDeleteMember"
            >
              <text class="delete-icon">Ã—</text>
            </view>
          </view>
          <text class="member-name">{{item.name}}{{item.relation !== 'æœ¬äºº' ? '(' + item.relation + ')' : ''}}</text>
          <text class="member-relation">{{item.relation}}</text>
        </view>
        
        <!-- å¦‚æœæ²¡æœ‰å®¶åº­æˆå‘˜ï¼Œæ˜¾ç¤ºæ·»åŠ æŒ‰é’® -->
        <view class="member-item add-member" wx:if="{{familyMembers.length === 0}}" bindtap="onAddFamilyMember">
          <view class="member-avatar add-avatar">
            <text class="add-icon">+</text>
          </view>
          <text class="member-name">æ·»åŠ æˆå‘˜</text>
          <text class="member-relation">å®¶äºº</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœ€è¿‘ç—…å† -->
  <view class="section records-section" wx:if="{{recentRecords.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘ç—…å†</text>
      <text class="section-more" bindtap="onViewMoreRecords">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    <view class="record-list">
      <view 
        class="record-item" 
        wx:for="{{recentRecords}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onRecordTap"
      >
              <view class="record-info">
        <text class="record-title">{{item.title}}</text>
        <text class="record-meta">{{item.member}}{{item.relation ? 'ï¼ˆ' + item.relation + 'ï¼‰' : ''}} Â· {{item.hospital}}</text>
      </view>
        <text class="record-date">{{item.date}}</text>
      </view>
    </view>
  </view>

  <!-- å³å°†åˆ°æ¥çš„æé†’ -->
  <view class="section reminders-section" wx:if="{{upcomingReminders.length > 0}}">
    <view class="section-header">
      <text class="section-title">å³å°†åˆ°æ¥çš„æé†’</text>
      <text class="section-more" bindtap="onViewMoreReminders">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    <view class="reminder-list">
      <view 
        class="reminder-item" 
        wx:for="{{upcomingReminders}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onReminderTap"
      >
        <view class="reminder-icon {{item.type}}">
          <text>{{item.type === 'medical' ? 'ğŸ¥' : 'ğŸ’Š'}}</text>
        </view>
              <view class="reminder-info">
        <text class="reminder-title">{{item.title}}</text>
        <text class="reminder-meta">{{item.member}}{{item.relation ? 'ï¼ˆ' + item.relation + 'ï¼‰' : ''}} Â· {{item.time}}</text>
      </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!hasUserInfo}}">
    <view class="empty-icon">ğŸ‘‹</view>
    <text class="empty-title">æ¬¢è¿ä½¿ç”¨AIç—…ä¾‹ç®¡ç†</text>
    <text class="empty-desc">å¼€å§‹ç®¡ç†æ‚¨çš„å®¶åº­å¥åº·ä¿¡æ¯</text>
    <button class="start-btn" bindtap="onStartUse">å¼€å§‹ä½¿ç”¨</button>
  </view>

  <!-- å®¶åº­æˆå‘˜è¯¦æƒ…å¼¹çª— -->
  <view class="family-modal" wx:if="{{showFamilyModal}}" bindtap="onCloseFamilyModal">
    <view class="modal-content" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">å®¶åº­æˆå‘˜ç®¡ç†</text>
        <view class="modal-close" bindtap="onCloseFamilyModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>
      
      <scroll-view class="modal-body" scroll-y="true">
        <view class="all-members-list">
          <view 
            class="member-card" 
            wx:for="{{allFamilyMembers}}" 
            wx:key="id"
          >
            <view class="member-card-avatar">
              <image 
                class="member-card-img" 
                src="{{item.avatar || '/images/default-avatar.png'}}" 
                mode="aspectFill"
              />
            </view>
            <view class="member-card-info">
              <text class="member-card-name">{{item.name}}</text>
              <text class="member-card-relation">{{item.relation}}</text>
              <text class="member-card-phone" wx:if="{{item.phone}}">ğŸ“± {{item.phone}}</text>
              <text class="member-card-birthday" wx:if="{{item.birthday}}">ğŸ‚ {{item.birthday}}</text>
            </view>
            <view class="member-card-actions" wx:if="{{item.relation !== 'æœ¬äºº'}}">
              <view 
                class="action-btn delete-btn"
                data-id="{{item.id}}"
                data-name="{{item.name}}"
                bindtap="onDeleteMember"
              >åˆ é™¤</view>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <view class="modal-footer">
        <view class="add-member-btn" bindtap="onAddFamilyMember">
          <text class="add-btn-icon">+</text>
          <text class="add-btn-text">æ·»åŠ æˆå‘˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- AIåˆ†æå¼¹çª— -->
  <view class="ai-modal" wx:if="{{showAIModal}}" bindtap="onCloseAIModal">
    <view class="ai-modal-content" catchtap="true">
      <view class="ai-modal-header">
        <text class="ai-modal-title">ğŸ¤– AIæ™ºèƒ½ç—…ä¾‹åˆ†æ</text>
        <view class="ai-modal-close" bindtap="onCloseAIModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>
      
      <!-- æ¨¡å‹é€‰æ‹©é˜¶æ®µ -->
      <scroll-view class="ai-modal-body" scroll-y="true" wx:if="{{!analysisResult}}">
        <view class="ai-description">
          <text class="ai-desc-text">é€‰æ‹©AIæ¨¡å‹å¯¹æ‚¨çš„ç—…ä¾‹è¿›è¡Œæ™ºèƒ½åˆ†æ</text>
          <text class="ai-desc-note">âš ï¸ æ•°æ®ä»…åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</text>
        </view>
        
        <view class="ai-models-list">
          <view 
            class="ai-model-card {{selectedModel === item.id ? 'selected' : ''}}" 
            wx:for="{{aiModels}}" 
            wx:key="id"
            data-model="{{item.id}}"
            bindtap="onSelectModel"
          >
            <view class="ai-model-header">
              <text class="ai-model-icon">{{item.icon}}</text>
              <view class="ai-model-info">
                <text class="ai-model-name">{{item.name}}</text>
                <text class="ai-model-accuracy">å‡†ç¡®ç‡: {{item.accuracy}}</text>
              </view>
              <view class="ai-model-select">
                <text class="select-icon">{{selectedModel === item.id ? 'âœ“' : 'â—‹'}}</text>
              </view>
            </view>
            <text class="ai-model-desc">{{item.description}}</text>
            <view class="ai-model-features">
              <text 
                class="feature-tag" 
                wx:for="{{item.features}}" 
                wx:key="*this"
                wx:for-item="feature"
              >{{feature}}</text>
            </view>
          </view>
        </view>
        
        <view class="ai-analyze-btn-container">
          <view 
            class="ai-analyze-btn {{selectedModel ? 'active' : 'disabled'}}" 
            bindtap="onStartAnalysis"
          >
            <text class="analyze-btn-text">{{isAnalyzing ? 'åˆ†æä¸­...' : 'å¼€å§‹AIåˆ†æ'}}</text>
            <view class="analyze-loading" wx:if="{{isAnalyzing}}">
              <view class="loading-dot"></view>
              <view class="loading-dot"></view>
              <view class="loading-dot"></view>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <!-- åˆ†æç»“æœé˜¶æ®µ -->
      <scroll-view class="ai-modal-body" scroll-y="true" wx:if="{{analysisResult}}">
        <view class="analysis-result">
          <view class="result-header">
            <text class="result-model-name">{{analysisResult.name}}</text>
            <text class="result-confidence">å¯ä¿¡åº¦: {{analysisResult.confidence}}</text>
          </view>
          <view class="result-content">
            <text class="result-text">{{analysisResult.analysis}}</text>
          </view>
          <view class="result-actions">
            <view class="action-btn secondary" bindtap="onCloseAIModal">
              <text>å…³é—­</text>
            </view>
            <view class="action-btn primary" bindtap="onSaveReport">
              <text>ä¿å­˜æŠ¥å‘Š</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view> 