<!--pages/unlock/unlock.wxml-->
<view class="unlock-container">
  
  <!-- åº”ç”¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="app-info-section">
    <modern-card 
      type="basic"
      size="large"
      title="AIç—…ä¾‹ç®¡ç†"
      subtitle="è¯·éªŒè¯èº«ä»½ä»¥è§£é”åº”ç”¨"
      icon="ğŸ¥"
      showHeader="{{true}}"
      customStyle="margin-bottom: 32rpx; text-align: center;"
    />
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-info-section" wx:if="{{userInfo}}">
    <modern-card 
      type="profile"
      size="medium"
      title="{{userInfo.nickname || 'ç”¨æˆ·'}}"
      subtitle="æ¬¢è¿å›æ¥"
      avatar="{{userInfo.avatar || '/images/default-avatar.png'}}"
      showHeader="{{true}}"
      customStyle="margin-bottom: 24rpx;"
    />
  </view>

  <!-- å¯†ç è¾“å…¥åŒºåŸŸ -->
  <view class="password-section">
    <view class="password-card">
      <view class="password-dots">
        <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="index" 
              class="dot {{password.length >= index ? 'filled' : ''}}">
        </view>
      </view>

      <!-- é”™è¯¯æç¤º -->
      <view wx:if="{{errorMessage}}" class="error-message">
        <text class="error-icon">âš ï¸</text>
        <text class="error-text">{{errorMessage}}</text>
      </view>

      <!-- å°è¯•æ¬¡æ•°æç¤º -->
      <view wx:if="{{remainingAttempts < 5}}" class="attempts-warning">
        <text>è¿˜å¯å°è¯• {{remainingAttempts}} æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- æ•°å­—é”®ç›˜ -->
  <view class="keypad-section">
    <view class="keypad">
      <view class="keypad-row">
        <view class="key number" bindtap="inputNumber" data-num="1">1</view>
        <view class="key number" bindtap="inputNumber" data-num="2">2</view>
        <view class="key number" bindtap="inputNumber" data-num="3">3</view>
      </view>
      <view class="keypad-row">
        <view class="key number" bindtap="inputNumber" data-num="4">4</view>
        <view class="key number" bindtap="inputNumber" data-num="5">5</view>
        <view class="key number" bindtap="inputNumber" data-num="6">6</view>
      </view>
      <view class="keypad-row">
        <view class="key number" bindtap="inputNumber" data-num="7">7</view>
        <view class="key number" bindtap="inputNumber" data-num="8">8</view>
        <view class="key number" bindtap="inputNumber" data-num="9">9</view>
      </view>
      <view class="keypad-row">
        <view class="key empty"></view>
        <view class="key number" bindtap="inputNumber" data-num="0">0</view>
        <view class="key delete" bindtap="deleteNumber">
          <text class="delete-icon">âŒ«</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”Ÿç‰©è¯†åˆ«è§£é” -->
  <view class="biometric-section" wx:if="{{biometricEnabled}}">
    <modern-card 
      type="success"
      size="small"
      title="{{biometricText}}"
      subtitle="è½»è§¦ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«è§£é”"
      icon="{{biometricIcon}}"
      showHeader="{{true}}"
      showFooter="{{true}}"
      buttons="{{[{text: 'ä½¿ç”¨', type: 'primary'}]}}"
      bindcardtap="useBiometric"
      customStyle="margin: 24rpx 0;"
    />
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <modern-card 
      type="basic"
      size="small"
      showFooter="{{true}}"
      buttons="{{[{text: 'å¿˜è®°å¯†ç ', type: 'warning'}]}}"
      bindcardtap="forgotPassword"
      customStyle="margin-top: 24rpx;"
    />
  </view>

</view>

<!-- åº”ç”¨é”å®šçŠ¶æ€è¦†ç›–å±‚ -->
<view wx:if="{{isLocked}}" class="locked-overlay">
  <view class="locked-content">
    <modern-card 
      type="error"
      size="large"
      title="åº”ç”¨å·²é”å®š"
      subtitle="ç”±äºå¤šæ¬¡è¾“å…¥é”™è¯¯å¯†ç "
      icon="ğŸ”’"
      showHeader="{{true}}"
      showFooter="{{true}}"
      content="è¯·ç­‰å¾… {{lockTimeRemaining}} ç§’åé‡è¯•"
      buttons="{{emergencyMode ? [{text: 'ç´§æ€¥ç”µè¯', type: 'error'}, {text: 'è”ç³»å®¶äºº', type: 'warning'}] : []}}"
      bindcardtap="onEmergencyAction"
    />
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-bar">
        <view class="progress" style="width: {{lockProgress}}%"></view>
      </view>
      <text class="progress-text">è§£é”è¿›åº¦: {{Math.floor(lockProgress)}}%</text>
    </view>
  </view>
</view>

<!-- ç°ä»£åŒ–Toastç»„ä»¶ -->
<modern-toast id="modern-toast" />

<!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
<loading-indicator 
  wx:if="{{loading}}"
  type="spinner" 
  text="æ­£åœ¨åˆå§‹åŒ–..." 
  size="large"
/> 