<!--pages/record/record-optimized.wxml - å…¨é¢ä¼˜åŒ–çš„ç—…å†ç®¡ç†é¡µé¢-->
<view class="record-container-modern">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="top-navigation">
    <view class="nav-header">
      <view class="nav-left">
        <text class="page-title text-2xl">ç—…å†ç®¡ç†</text>
        <text class="page-subtitle text-sm">{{totalRecords}}æ¡è®°å½•</text>
      </view>
      <view class="nav-right">
        <view class="nav-action-btn" bindtap="onShowStats">
          <text class="nav-icon">ğŸ“Š</text>
        </view>
        <view class="nav-action-btn" bindtap="onShowSettings">
          <text class="nav-icon">âš™ï¸</text>
        </view>
      </view>
    </view>
    
    <!-- æ™ºèƒ½æœç´¢æ  -->
    <view class="smart-search-bar">
      <view class="search-container">
        <view class="search-icon">ğŸ”</view>
        <input 
          class="search-input-modern"
          placeholder="æ™ºèƒ½æœç´¢ç—…å†ã€ç—‡çŠ¶ã€åŒ»é™¢..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindfocus="onSearchFocus"
          bindblur="onSearchBlur"
        />
        <view class="search-actions">
          <view class="clear-btn-modern" wx:if="{{searchKeyword}}" bindtap="onClearSearch">
            <text>Ã—</text>
          </view>
          <view class="voice-search-btn" bindtap="onVoiceSearch">
            <text>ğŸ¤</text>
          </view>
          <view class="ai-search-btn" bindtap="onAISearch">
            <text>ğŸ¤–</text>
          </view>
        </view>
      </view>
      
      <!-- æœç´¢å»ºè®® -->
      <view class="search-suggestions" wx:if="{{showSearchSuggestions && searchSuggestions.length > 0}}">
        <view 
          class="suggestion-item"
          wx:for="{{searchSuggestions}}"
          wx:key="id"
          data-keyword="{{item.keyword}}"
          bindtap="onSelectSuggestion"
        >
          <text class="suggestion-icon">{{item.icon}}</text>
          <text class="suggestion-text">{{item.keyword}}</text>
          <text class="suggestion-count">{{item.count}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿç­›é€‰æ ‡ç­¾ -->
  <scroll-view class="quick-filters" scroll-x="true">
    <view class="filter-tags">
      <view 
        class="filter-tag {{activeFilter === 'all' ? 'active' : ''}}"
        data-filter="all"
        bindtap="onQuickFilter"
      >
        <text class="tag-icon">ğŸ“‹</text>
        <text class="tag-text">å…¨éƒ¨</text>
        <view class="tag-badge" wx:if="{{filterCounts.all > 0}}">{{filterCounts.all}}</view>
      </view>
      
      <view 
        class="filter-tag {{activeFilter === 'recent' ? 'active' : ''}}"
        data-filter="recent"
        bindtap="onQuickFilter"
      >
        <text class="tag-icon">ğŸ•’</text>
        <text class="tag-text">æœ€è¿‘</text>
        <view class="tag-badge" wx:if="{{filterCounts.recent > 0}}">{{filterCounts.recent}}</view>
      </view>
      
      <view 
        class="filter-tag {{activeFilter === 'important' ? 'active' : ''}}"
        data-filter="important"
        bindtap="onQuickFilter"
      >
        <text class="tag-icon">â­</text>
        <text class="tag-text">é‡è¦</text>
        <view class="tag-badge" wx:if="{{filterCounts.important > 0}}">{{filterCounts.important}}</view>
      </view>
      
      <view 
        class="filter-tag {{activeFilter === 'emergency' ? 'active' : ''}}"
        data-filter="emergency"
        bindtap="onQuickFilter"
      >
        <text class="tag-icon">ğŸš¨</text>
        <text class="tag-text">æ€¥è¯Š</text>
        <view class="tag-badge" wx:if="{{filterCounts.emergency > 0}}">{{filterCounts.emergency}}</view>
      </view>
      
      <view 
        class="filter-tag {{activeFilter === 'prescription' ? 'active' : ''}}"
        data-filter="prescription"
        bindtap="onQuickFilter"
      >
        <text class="tag-icon">ğŸ’Š</text>
        <text class="tag-text">å¤„æ–¹</text>
        <view class="tag-badge" wx:if="{{filterCounts.prescription > 0}}">{{filterCounts.prescription}}</view>
      </view>
      
      <view class="filter-tag filter-more" bindtap="onShowAdvancedFilter">
        <text class="tag-icon">ğŸ”§</text>
        <text class="tag-text">æ›´å¤šç­›é€‰</text>
      </view>
    </view>
  </scroll-view>

  <!-- æ™ºèƒ½åˆ†æå¡ç‰‡ -->
  <view class="ai-insights-card" wx:if="{{showAIInsights && aiInsights}}">
    <view class="insights-header">
      <text class="insights-title">ğŸ§  AIæ™ºèƒ½åˆ†æ</text>
      <view class="insights-actions">
        <text class="insights-more" bindtap="onViewMoreInsights">è¯¦ç»†</text>
        <text class="insights-close" bindtap="onCloseInsights">Ã—</text>
      </view>
    </view>
    <view class="insights-content">
      <text class="insights-summary">{{aiInsights.summary}}</text>
      <view class="insights-tags">
        <text 
          class="insight-tag"
          wx:for="{{aiInsights.tags}}"
          wx:key="*this"
        >{{item}}</text>
      </view>
    </view>
  </view>

  <!-- ç—…å†æ—¶é—´çº¿è§†å›¾ -->
  <view class="view-toggle" wx:if="{{filteredRecords.length > 0}}">
    <view class="toggle-buttons">
      <view 
        class="toggle-btn {{viewMode === 'card' ? 'active' : ''}}"
        data-mode="card"
        bindtap="onToggleView"
      >
        <text class="toggle-icon">ğŸ“‹</text>
        <text class="toggle-text">å¡ç‰‡</text>
      </view>
      <view 
        class="toggle-btn {{viewMode === 'timeline' ? 'active' : ''}}"
        data-mode="timeline"
        bindtap="onToggleView"
      >
        <text class="toggle-icon">ğŸ“…</text>
        <text class="toggle-text">æ—¶é—´çº¿</text>
      </view>
      <view 
        class="toggle-btn {{viewMode === 'calendar' ? 'active' : ''}}"
        data-mode="calendar"
        bindtap="onToggleView"
      >
        <text class="toggle-icon">ğŸ“†</text>
        <text class="toggle-text">æ—¥å†</text>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <scroll-view 
    class="content-scroll"
    scroll-y
    enable-flex
    refresher-enabled
    refresher-triggered="{{loading && page === 0}}"
    bindrefresherrefresh="refreshData"
    bindscrolltolower="loadMoreRecords"
    enhanced="true"
    bounces="true"
  >
    <!-- éª¨æ¶å±åŠ è½½ -->
    <view class="skeleton-container" wx:if="{{loading && filteredRecords.length === 0}}">
      <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-header">
          <view class="skeleton-title skeleton"></view>
          <view class="skeleton-date skeleton"></view>
        </view>
        <view class="skeleton-content">
          <view class="skeleton-line skeleton"></view>
          <view class="skeleton-line skeleton"></view>
          <view class="skeleton-line short skeleton"></view>
        </view>
      </view>
    </view>

    <!-- æ™ºèƒ½ç©ºçŠ¶æ€ -->
    <view class="empty-state-smart" wx:elif="{{!loading && filteredRecords.length === 0}}">
      <view class="empty-animation">
        <text class="empty-icon-animated">ğŸ“‹</text>
      </view>
      <text class="empty-title-modern">{{emptyStateConfig.title}}</text>
      <text class="empty-desc-modern">{{emptyStateConfig.description}}</text>
      
      <!-- æ™ºèƒ½å»ºè®® -->
      <view class="empty-suggestions">
        <view 
          class="suggestion-card"
          wx:for="{{emptyStateConfig.suggestions}}"
          wx:key="id"
          data-action="{{item.action}}"
          bindtap="onEmptySuggestion"
        >
          <text class="suggestion-icon">{{item.icon}}</text>
          <text class="suggestion-title">{{item.title}}</text>
        </view>
      </view>
      
      <button class="cta-button btn-modern btn-modern-primary" bindtap="onAddRecord">
        <text class="cta-icon">+</text>
        <text class="cta-text">æ·»åŠ ç¬¬ä¸€æ¡ç—…å†</text>
      </button>
    </view>

    <!-- å¡ç‰‡è§†å›¾ -->
    <view class="record-cards-modern" wx:elif="{{viewMode === 'card'}}">
      <view 
        wx:for="{{filteredRecords}}" 
        wx:key="_id"
        class="record-card-modern card-modern touchable-card"
        data-id="{{item._id}}"
        bindtap="onViewRecord"
        bindlongpress="onLongPressRecord"
      >
        <!-- å¡ç‰‡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <view class="card-status-indicator status-{{item.priority || 'normal'}}"></view>
        
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header-modern">
          <view class="header-main">
            <text class="record-title-modern text-lg">{{item.title}}</text>
            <view class="record-tags">
              <text class="record-tag tag tag-{{item.type || 'default'}}">{{item.typeLabel || 'é—¨è¯Š'}}</text>
              <text class="record-tag tag tag-priority-{{item.priority || 'normal'}}" wx:if="{{item.priority && item.priority !== 'normal'}}">
                {{item.priorityLabel}}
              </text>
            </view>
          </view>
          <view class="header-actions">
            <view class="quick-action-btn" catchtap="onQuickEdit" data-id="{{item._id}}">
              <text class="action-icon">âœï¸</text>
            </view>
            <view class="quick-action-btn" catchtap="onQuickShare" data-id="{{item._id}}">
              <text class="action-icon">ğŸ“¤</text>
            </view>
            <view class="more-actions-btn" catchtap="onMoreActions" data-id="{{item._id}}">
              <text class="more-icon">â‹¯</text>
            </view>
          </view>
        </view>

        <!-- æ—¶é—´å’Œæˆå‘˜ä¿¡æ¯ -->
        <view class="record-meta-modern">
          <view class="meta-item">
            <text class="meta-icon">ğŸ“…</text>
            <text class="meta-text text-sm">{{item.date}} {{item.time}}</text>
          </view>
          <view class="meta-item">
            <text class="meta-icon">ğŸ‘¤</text>
            <text class="meta-text text-sm">{{item.member}}</text>
          </view>
          <view class="meta-item" wx:if="{{item.doctor}}">
            <text class="meta-icon">ğŸ‘¨â€âš•ï¸</text>
            <text class="meta-text text-sm">{{item.doctor}}</text>
          </view>
        </view>

        <!-- åŒ»é™¢å’Œè¯Šæ–­ä¿¡æ¯ -->
        <view class="hospital-info-modern">
          <view class="hospital-main">
            <text class="hospital-name-modern">ğŸ¥ {{item.hospital}}</text>
            <text class="department-name" wx:if="{{item.department}}">{{item.department}}</text>
          </view>
          <view class="diagnosis-info" wx:if="{{item.diagnosis}}">
            <text class="diagnosis-label">è¯Šæ–­ï¼š</text>
            <text class="diagnosis-text">{{item.diagnosis}}</text>
          </view>
        </view>

        <!-- ç—‡çŠ¶å’Œæ²»ç–—æ‘˜è¦ -->
        <view class="medical-summary" wx:if="{{item.symptoms || item.treatment}}">
          <view class="summary-item" wx:if="{{item.symptoms}}">
            <text class="summary-label">ç—‡çŠ¶</text>
            <text class="summary-content text-sm">{{item.symptoms}}</text>
          </view>
          <view class="summary-item" wx:if="{{item.treatment}}">
            <text class="summary-label">æ²»ç–—</text>
            <text class="summary-content text-sm">{{item.treatment}}</text>
          </view>
        </view>

        <!-- AIåˆ†ææ ‡ç­¾ -->
        <view class="ai-analysis-tags" wx:if="{{item.aiAnalysis && item.aiAnalysis.tags}}">
          <text class="ai-label">ğŸ¤– AIåˆ†æï¼š</text>
          <view class="ai-tags-list">
            <text 
              class="ai-tag"
              wx:for="{{item.aiAnalysis.tags}}"
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>

        <!-- é™„ä»¶ä¿¡æ¯ -->
        <view class="attachments-info" wx:if="{{item.attachments && item.attachments.length > 0}}">
          <view class="attachment-item" wx:if="{{item.images && item.images.length > 0}}">
            <text class="attachment-icon">ğŸ“·</text>
            <text class="attachment-count">{{item.images.length}}å¼ å›¾ç‰‡</text>
          </view>
          <view class="attachment-item" wx:if="{{item.documents && item.documents.length > 0}}">
            <text class="attachment-icon">ğŸ“„</text>
            <text class="attachment-count">{{item.documents.length}}ä¸ªæ–‡æ¡£</text>
          </view>
          <view class="attachment-item" wx:if="{{item.prescriptions && item.prescriptions.length > 0}}">
            <text class="attachment-icon">ğŸ’Š</text>
            <text class="attachment-count">{{item.prescriptions.length}}ä¸ªå¤„æ–¹</text>
          </view>
        </view>

        <!-- å¡ç‰‡åº•éƒ¨ -->
        <view class="card-footer-modern">
          <view class="footer-left">
            <text class="cost-info" wx:if="{{item.cost}}">
              <text class="cost-icon">ğŸ’°</text>
              <text class="cost-amount">Â¥{{item.cost}}</text>
            </text>
            <view class="follow-up-info" wx:if="{{item.followUpDate}}">
              <text class="follow-up-icon">ğŸ“…</text>
              <text class="follow-up-text text-xs">å¤è¯Šï¼š{{item.followUpDate}}</text>
            </view>
          </view>
          <view class="footer-right">
            <view class="record-score" wx:if="{{item.aiScore}}">
              <text class="score-label">å¥åº·è¯„åˆ†</text>
              <view class="score-bar">
                <view class="score-fill" style="width: {{item.aiScore}}%"></view>
              </view>
              <text class="score-value">{{item.aiScore}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´çº¿è§†å›¾ -->
    <view class="timeline-view" wx:elif="{{viewMode === 'timeline'}}">
      <view class="timeline-container">
        <view 
          class="timeline-group"
          wx:for="{{timelineGroups}}"
          wx:key="date"
        >
          <view class="timeline-date-header">
            <text class="timeline-date">{{item.date}}</text>
            <text class="timeline-count">{{item.records.length}}æ¡è®°å½•</text>
          </view>
          
          <view class="timeline-items">
            <view 
              class="timeline-item"
              wx:for="{{item.records}}"
              wx:for-item="record"
              wx:key="_id"
              data-id="{{record._id}}"
              bindtap="onViewRecord"
            >
              <view class="timeline-dot timeline-dot-{{record.type || 'default'}}"></view>
              <view class="timeline-content card-modern">
                <view class="timeline-header">
                  <text class="timeline-title">{{record.title}}</text>
                  <text class="timeline-time">{{record.time}}</text>
                </view>
                <text class="timeline-hospital">{{record.hospital}}</text>
                <text class="timeline-diagnosis" wx:if="{{record.diagnosis}}">{{record.diagnosis}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¥å†è§†å›¾ -->
    <view class="calendar-view" wx:elif="{{viewMode === 'calendar'}}">
      <view class="calendar-container">
        <!-- æ—¥å†å¤´éƒ¨ -->
        <view class="calendar-header">
          <view class="calendar-nav">
            <text class="nav-btn" bindtap="onPrevMonth">â€¹</text>
            <text class="calendar-title">{{calendarTitle}}</text>
            <text class="nav-btn" bindtap="onNextMonth">â€º</text>
          </view>
        </view>
        
        <!-- æ—¥å†ç½‘æ ¼ -->
        <view class="calendar-grid">
          <view class="calendar-weekdays">
            <text class="weekday" wx:for="{{weekdays}}" wx:key="*this">{{item}}</text>
          </view>
          <view class="calendar-days">
            <view 
              class="calendar-day {{day.isCurrentMonth ? '' : 'other-month'}} {{day.isToday ? 'today' : ''}} {{day.hasRecords ? 'has-records' : ''}}"
              wx:for="{{calendarDays}}"
              wx:for-item="day"
              wx:key="date"
              data-date="{{day.date}}"
              bindtap="onSelectDate"
            >
              <text class="day-number">{{day.day}}</text>
              <view class="day-indicators" wx:if="{{day.records && day.records.length > 0}}">
                <view 
                  class="record-indicator indicator-{{record.type || 'default'}}"
                  wx:for="{{day.records}}"
                  wx:for-item="record"
                  wx:key="_id"
                ></view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- é€‰ä¸­æ—¥æœŸçš„è®°å½• -->
        <view class="selected-date-records" wx:if="{{selectedDateRecords.length > 0}}">
          <text class="selected-date-title">{{selectedDate}} çš„è®°å½•</text>
          <view class="mini-record-list">
            <view 
              class="mini-record-item"
              wx:for="{{selectedDateRecords}}"
              wx:key="_id"
              data-id="{{item._id}}"
              bindtap="onViewRecord"
            >
              <text class="mini-record-title">{{item.title}}</text>
              <text class="mini-record-hospital">{{item.hospital}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more-modern" wx:if="{{hasMore && filteredRecords.length > 0}}">
      <view class="load-more-content">
        <view class="loading-spinner" wx:if="{{loading}}"></view>
        <text class="load-more-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
      </view>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more-modern" wx:if="{{!hasMore && filteredRecords.length > 0}}">
      <view class="no-more-content">
        <text class="no-more-text">å·²æ˜¾ç¤ºå…¨éƒ¨ {{filteredRecords.length}} æ¡è®°å½•</text>
      </view>
    </view>
  </scroll-view>

  <!-- æ™ºèƒ½æµ®åŠ¨æ“ä½œèœå• -->
  <view class="smart-fab-container">
    <view class="fab-menu {{showFabMenu ? 'expanded' : ''}}" wx:if="{{showFabMenu}}">
      <view class="fab-item" bindtap="onQuickAddRecord">
        <text class="fab-icon">ğŸ“‹</text>
        <text class="fab-label">å¿«é€Ÿè®°å½•</text>
      </view>
      <view class="fab-item" bindtap="onScanPrescription">
        <text class="fab-icon">ğŸ“·</text>
        <text class="fab-label">æ‰«æå¤„æ–¹</text>
      </view>
      <view class="fab-item" bindtap="onVoiceRecord">
        <text class="fab-icon">ğŸ¤</text>
        <text class="fab-label">è¯­éŸ³è®°å½•</text>
      </view>
      <view class="fab-item" bindtap="onImportRecord">
        <text class="fab-icon">ğŸ“¥</text>
        <text class="fab-label">å¯¼å…¥è®°å½•</text>
      </view>
    </view>
    
    <view class="main-fab {{showFabMenu ? 'rotated' : ''}}" bindtap="onToggleFab">
      <text class="fab-main-icon">{{showFabMenu ? 'Ã—' : '+'}}</text>
    </view>
  </view>

  <!-- é«˜çº§ç­›é€‰å¼¹çª— -->
  <view class="advanced-filter-modal" wx:if="{{showAdvancedFilter}}">
    <view class="modal-mask" bindtap="onCloseAdvancedFilter"></view>
    <view class="modal-content-advanced">
      <view class="modal-header-modern">
        <text class="modal-title-modern">é«˜çº§ç­›é€‰</text>
        <view class="modal-actions">
          <text class="modal-reset" bindtap="onResetFilter">é‡ç½®</text>
          <text class="modal-close" bindtap="onCloseAdvancedFilter">Ã—</text>
        </view>
      </view>
      
      <scroll-view class="filter-content-modern" scroll-y>
        <!-- æ—¥æœŸèŒƒå›´ -->
        <view class="filter-section">
          <text class="section-title">ğŸ“… æ—¥æœŸèŒƒå›´</text>
          <view class="date-range-picker">
            <picker
              mode="date"
              value="{{advancedFilter.startDate}}"
              data-field="startDate"
              bindchange="onAdvancedFilterChange"
            >
              <view class="date-picker-input">
                <text class="{{!advancedFilter.startDate ? 'placeholder' : ''}}">
                  {{advancedFilter.startDate || 'å¼€å§‹æ—¥æœŸ'}}
                </text>
              </view>
            </picker>
            <text class="date-separator">è‡³</text>
            <picker
              mode="date"
              value="{{advancedFilter.endDate}}"
              data-field="endDate"
              bindchange="onAdvancedFilterChange"
            >
              <view class="date-picker-input">
                <text class="{{!advancedFilter.endDate ? 'placeholder' : ''}}">
                  {{advancedFilter.endDate || 'ç»“æŸæ—¥æœŸ'}}
                </text>
              </view>
            </picker>
          </view>
        </view>

        <!-- å®¶åº­æˆå‘˜ -->
        <view class="filter-section">
          <text class="section-title">ğŸ‘¥ å®¶åº­æˆå‘˜</text>
          <view class="member-filter-grid">
            <view 
              class="member-filter-item {{advancedFilter.members.includes(member.id) ? 'selected' : ''}}"
              wx:for="{{familyMembers}}"
              wx:for-item="member"
              wx:key="id"
              data-id="{{member.id}}"
              bindtap="onToggleMemberFilter"
            >
              <image class="member-avatar-small" src="{{member.avatar}}" mode="aspectFill" />
              <text class="member-name-small">{{member.name}}</text>
            </view>
          </view>
        </view>

        <!-- åŒ»é™¢ -->
        <view class="filter-section">
          <text class="section-title">ğŸ¥ åŒ»é™¢</text>
          <view class="hospital-filter-list">
            <view 
              class="hospital-filter-item {{advancedFilter.hospitals.includes(hospital) ? 'selected' : ''}}"
              wx:for="{{hospitalList}}"
              wx:for-item="hospital"
              wx:key="*this"
              data-hospital="{{hospital}}"
              bindtap="onToggleHospitalFilter"
            >
              <text class="hospital-filter-name">{{hospital}}</text>
            </view>
          </view>
        </view>

        <!-- è®°å½•ç±»å‹ -->
        <view class="filter-section">
          <text class="section-title">ğŸ“‹ è®°å½•ç±»å‹</text>
          <view class="type-filter-grid">
            <view 
              class="type-filter-item {{advancedFilter.types.includes(type.value) ? 'selected' : ''}}"
              wx:for="{{recordTypes}}"
              wx:for-item="type"
              wx:key="value"
              data-type="{{type.value}}"
              bindtap="onToggleTypeFilter"
            >
              <text class="type-icon">{{type.icon}}</text>
              <text class="type-name">{{type.label}}</text>
            </view>
          </view>
        </view>

        <!-- è´¹ç”¨èŒƒå›´ -->
        <view class="filter-section">
          <text class="section-title">ğŸ’° è´¹ç”¨èŒƒå›´</text>
          <view class="cost-range-slider">
            <slider
              min="0"
              max="10000"
              step="100"
              value="{{advancedFilter.maxCost}}"
              data-field="maxCost"
              bindchange="onAdvancedFilterChange"
              show-value
            />
            <text class="cost-range-label">æœ€é«˜è´¹ç”¨ï¼šÂ¥{{advancedFilter.maxCost}}</text>
          </view>
        </view>

        <!-- AIè¯„åˆ† -->
        <view class="filter-section">
          <text class="section-title">ğŸ¤– AIå¥åº·è¯„åˆ†</text>
          <view class="score-range-picker">
            <picker
              range="{{scoreRanges}}"
              range-key="label"
              value="{{advancedFilter.scoreRangeIndex}}"
              data-field="scoreRangeIndex"
              bindchange="onAdvancedFilterChange"
            >
              <view class="score-picker-input">
                <text>{{scoreRanges[advancedFilter.scoreRangeIndex].label}}</text>
              </view>
            </picker>
          </view>
        </view>
      </scroll-view>
      
      <view class="modal-footer-modern">
        <button class="filter-btn filter-cancel" bindtap="onCloseAdvancedFilter">å–æ¶ˆ</button>
        <button class="filter-btn filter-apply btn-modern-primary" bindtap="onApplyAdvancedFilter">åº”ç”¨ç­›é€‰</button>
      </view>
    </view>
  </view>

  <!-- è®°å½•è¯¦æƒ…é¢„è§ˆå¼¹çª— -->
  <view class="record-preview-modal" wx:if="{{showPreviewModal && previewRecord}}">
    <view class="modal-mask" bindtap="onClosePreview"></view>
    <view class="preview-content">
      <view class="preview-header">
        <text class="preview-title">{{previewRecord.title}}</text>
        <text class="preview-close" bindtap="onClosePreview">Ã—</text>
      </view>
      <scroll-view class="preview-body" scroll-y>
        <view class="preview-section">
          <text class="preview-label">åŸºæœ¬ä¿¡æ¯</text>
          <text class="preview-value">{{previewRecord.date}} {{previewRecord.time}}</text>
          <text class="preview-value">{{previewRecord.hospital}} - {{previewRecord.department}}</text>
          <text class="preview-value">æ‚£è€…ï¼š{{previewRecord.member}}</text>
        </view>
        <view class="preview-section" wx:if="{{previewRecord.diagnosis}}">
          <text class="preview-label">è¯Šæ–­ç»“æœ</text>
          <text class="preview-value">{{previewRecord.diagnosis}}</text>
        </view>
        <view class="preview-section" wx:if="{{previewRecord.symptoms}}">
          <text class="preview-label">ç—‡çŠ¶æè¿°</text>
          <text class="preview-value">{{previewRecord.symptoms}}</text>
        </view>
        <view class="preview-section" wx:if="{{previewRecord.treatment}}">
          <text class="preview-label">æ²»ç–—æ–¹æ¡ˆ</text>
          <text class="preview-value">{{previewRecord.treatment}}</text>
        </view>
      </scroll-view>
      <view class="preview-footer">
        <button class="preview-btn preview-edit" bindtap="onEditFromPreview">ç¼–è¾‘</button>
        <button class="preview-btn preview-view btn-modern-primary" bindtap="onViewFromPreview">æŸ¥çœ‹è¯¦æƒ…</button>
      </view>
    </view>
  </view>

  <!-- å…¨å±€åŠ è½½é®ç½© -->
  <view class="global-loading-overlay" wx:if="{{globalLoading}}">
    <view class="global-loading-content">
      <view class="loading-spinner-large"></view>
      <text class="global-loading-text">{{loadingText || 'å¤„ç†ä¸­...'}}</text>
    </view>
  </view>
</view> 