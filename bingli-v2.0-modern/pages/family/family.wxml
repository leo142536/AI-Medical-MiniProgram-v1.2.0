<!-- pages/family/family.wxml -->
<!-- åŸºäºGitHubæœ€ä½³å®è·µçš„ç°ä»£åŒ–å®¶åº­é¡µé¢ -->
<view class="family-container">
  <!-- å®¶åº­ä¿¡æ¯å¡ç‰‡ -->
  <modern-card 
    wx:if="{{familyInfo}}"
    title="{{familyInfo.name}}"
    subtitle="{{members.length}}ä½å®¶åº­æˆå‘˜"
    type="featured"
    size="large"
    shadow="large"
    class="family-info-card"
  >
    <!-- å¡ç‰‡å¤´éƒ¨æ“ä½œ -->
    <view slot="header-action" class="family-header-actions">
      <button 
        class="modern-btn icon-btn" 
        wx:if="{{isAdmin}}"
        bind:tap="onEditFamily"
      >
        âœï¸
      </button>
      <button class="modern-btn icon-btn" bind:tap="onShareFamily">
        ğŸ“¤
      </button>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view slot="content" class="family-stats">
      <view class="stat-card">
        <view class="stat-number">{{members.length}}</view>
        <view class="stat-label">å®¶åº­æˆå‘˜</view>
        <view class="stat-icon">ğŸ‘¥</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{monthlyRecords || 0}}</view>
        <view class="stat-label">æœ¬æœˆç—…å†</view>
        <view class="stat-icon">ğŸ“‹</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{pendingReminders || 0}}</view>
        <view class="stat-label">å¾…åŠæé†’</view>
        <view class="stat-icon">â°</view>
      </view>
    </view>
  </modern-card>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="members-section">
    <view class="section-header">
      <text class="section-title">å®¶åº­æˆå‘˜</text>
      <button 
        class="modern-btn primary-btn add-member-btn" 
        wx:if="{{isAdmin}}"
        bind:tap="onAddMember"
      >
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ æˆå‘˜</text>
      </button>
    </view>

    <view class="modern-cards-container">
      <modern-card 
        wx:for="{{members}}" 
        wx:key="id"
        title="{{item.name}}"
        subtitle="{{item.relation}}"
        description="{{item.gender === 'male' ? 'ç”·' : 'å¥³'}} Â· {{item.birthday || 'æœªè®¾ç½®ç”Ÿæ—¥'}}"
        image="{{item.avatar || '/images/default-avatar.png'}}"
        type="profile"
        size="medium"
        hover-class="member-card-hover"
        bind:tap="onMemberTap"
        data-id="{{item.id}}"
      >
        <!-- ç®¡ç†å‘˜æ ‡è¯† -->
        <view slot="badge" wx:if="{{item.role === 'admin'}}" class="admin-badge">
          ç®¡ç†å‘˜
        </view>

        <!-- æˆå‘˜çŠ¶æ€ -->
        <view slot="status" class="member-status">
          <view class="status-dot {{item.isOnline ? 'online' : 'offline'}}"></view>
          <text class="status-text">{{item.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
        </view>

        <!-- æˆå‘˜æ“ä½œ -->
        <view slot="footer" class="member-actions">
          <button 
            class="modern-btn secondary-btn action-btn"
            catch:tap="onViewMemberRecords"
            data-id="{{item.id}}"
          >
            ç—…å†è®°å½•
          </button>
          <button 
            class="modern-btn secondary-btn action-btn"
            catch:tap="onViewMemberReminders"
            data-id="{{item.id}}"
          >
            å¥åº·æé†’
          </button>
          <view 
            class="more-actions"
            catch:tap="onMemberMoreActions"
            data-id="{{item.id}}"
          >
            <text class="more-icon">â‹¯</text>
          </view>
        </view>
      </modern-card>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!familyInfo && !loading}}">
    <loading-indicator 
      type="skeleton" 
      text="æš‚æ— å®¶åº­ä¿¡æ¯ï¼Œè¯·å…ˆå®Œæˆç™»å½•æ³¨å†Œ" 
      size="large"
    />
    <button class="modern-btn primary-btn start-btn" bind:tap="goToLogin">
      ç«‹å³ç™»å½•
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <loading-indicator 
      type="spinner" 
      text="æ­£åœ¨åŠ è½½å®¶åº­ä¿¡æ¯..." 
      size="large"
    />
  </view>

  <!-- æ‚¬æµ®æ“ä½œæŒ‰é’® -->
  <view class="fab-container" wx:if="{{familyInfo && isAdmin}}">
    <view class="fab" bind:tap="onShowFabMenu">
      <text class="fab-icon">{{showFabMenu ? 'Ã—' : '+'}}</text>
    </view>
    
    <view class="fab-menu {{showFabMenu ? 'show' : 'hide'}}">
      <view class="fab-item" bind:tap="onAddMember">
        <view class="fab-item-icon">ğŸ‘¤</view>
        <text class="fab-item-text">æ·»åŠ æˆå‘˜</text>
      </view>
      <view class="fab-item" bind:tap="onInviteMember">
        <view class="fab-item-icon">ğŸ“§</view>
        <text class="fab-item-text">é‚€è¯·æˆå‘˜</text>
      </view>
      <view class="fab-item" bind:tap="onFamilySettings">
        <view class="fab-item-icon">âš™ï¸</view>
        <text class="fab-item-text">å®¶åº­è®¾ç½®</text>
      </view>
    </view>
  </view>
</view> 